<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>企业级 Webpack 分享总结(内附完整ppt) | 前端知识体库</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/img/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b71a9117.css" as="style"><link rel="preload" href="/assets/js/app.84527245.js" as="script"><link rel="preload" href="/assets/js/2.950285f0.js" as="script"><link rel="preload" href="/assets/js/6.336af2bb.js" as="script"><link rel="prefetch" href="/assets/js/10.6ebb2dca.js"><link rel="prefetch" href="/assets/js/11.4d80715b.js"><link rel="prefetch" href="/assets/js/12.c9cc1136.js"><link rel="prefetch" href="/assets/js/13.915e4a18.js"><link rel="prefetch" href="/assets/js/14.2328fc7b.js"><link rel="prefetch" href="/assets/js/15.0dc50344.js"><link rel="prefetch" href="/assets/js/16.08e5b6f7.js"><link rel="prefetch" href="/assets/js/17.dd414c2c.js"><link rel="prefetch" href="/assets/js/18.442e19e8.js"><link rel="prefetch" href="/assets/js/19.c198c499.js"><link rel="prefetch" href="/assets/js/3.ebfbad79.js"><link rel="prefetch" href="/assets/js/4.a4340c56.js"><link rel="prefetch" href="/assets/js/5.7c929023.js"><link rel="prefetch" href="/assets/js/7.55cb179c.js"><link rel="prefetch" href="/assets/js/8.1448209e.js"><link rel="prefetch" href="/assets/js/9.f4300e84.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b71a9117.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="前端知识体库" class="logo"> <span class="site-name can-hide">前端知识体库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  每日一鲜
</a></div><div class="nav-item"><a href="/blog.html" class="nav-link">
  学习博客
</a></div><div class="nav-item"><a href="https://juejin.im/timeline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://time.geekbang.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  极客时间
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.vuepress.cn/guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuepress
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wuzaofeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://voice.baidu.com/act/newpneumonia/newpneumonia/?from=osari_pc_3" target="_blank" rel="noopener noreferrer" class="nav-link external">
  疫情实时
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  每日一鲜
</a></div><div class="nav-item"><a href="/blog.html" class="nav-link">
  学习博客
</a></div><div class="nav-item"><a href="https://juejin.im/timeline" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://time.geekbang.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  极客时间
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.vuepress.cn/guide" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vuepress
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/wuzaofeng" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://voice.baidu.com/act/newpneumonia/newpneumonia/?from=osari_pc_3" target="_blank" rel="noopener noreferrer" class="nav-link external">
  疫情实时
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/guide/" class="sidebar-link">自动化部署静态文档</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning/html/" class="sidebar-link">html</a></li><li><a href="/learning/css/" class="sidebar-link">CSS</a></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning/javascript/expression.html" class="sidebar-link">什么是表达式语句</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning/typescript/ts-collection-question.html" class="sidebar-link">【好文】耗时一年整理，全网最全的TypeScript踩坑集锦 (纯 TS 问题)</a></li><li><a href="/learning/typescript/ts-collection-config.html" class="sidebar-link">【好文】耗时一年整理，全网最全的TypeScript踩坑集锦 (tsconfig.json 常用配置项注释)</a></li><li><a href="/learning/typescript/ts-collection-react.html" class="sidebar-link">【好文】耗时一年整理，全网最全的TypeScript踩坑集锦（React + TS 项目问题）</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>前端工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learning/project/webpack.html" class="active sidebar-link">【好文】企业级 Webpack 分享总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learning/project/webpack.html#基本打包机制" class="sidebar-link">基本打包机制</a></li><li class="sidebar-sub-header"><a href="/learning/project/webpack.html#打包过程" class="sidebar-link">打包过程</a></li><li class="sidebar-sub-header"><a href="/learning/project/webpack.html#webpack-loader" class="sidebar-link">Webpack Loader</a></li><li class="sidebar-sub-header"><a href="/learning/project/webpack.html#webpack-plugin" class="sidebar-link">Webpack Plugin</a></li><li class="sidebar-sub-header"><a href="/learning/project/webpack.html#构建工具选择" class="sidebar-link">构建工具选择</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>读书笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/readBook/HighPerformanceJS/" class="sidebar-link">高性能javascript</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工作笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/working/wechat/webview.html" class="sidebar-link">微信小程序内嵌webview问题</a></li><li><a href="/working/verdaccio.html" class="sidebar-link">verdaccio 指南</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面试笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/job/jobing1.html" class="sidebar-link">面试题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="企业级-webpack-分享总结-内附完整ppt"><a href="#企业级-webpack-分享总结-内附完整ppt" class="header-anchor">#</a> 企业级 Webpack 分享总结(内附完整ppt)</h1> <h2 id="基本打包机制"><a href="#基本打包机制" class="header-anchor">#</a> 基本打包机制</h2> <div class="custom-block tip"><p class="custom-block-title">解释</p> <p>本质上，webpack 是一个现代 JavaScript 应用程序的<strong>静态模块打包器</strong>(<code>module bundler</code>)。当 webpack 处理应用程序时，它会<strong>递归地构建</strong>一个<strong>依赖关系图</strong>(<code>dependency graph</code>)，其中包含应用程序需要的每个模块，然后将所有这些模块<strong>打包</strong>成一个或多个<code>bundle</code></p></div> <p>打包过程可以拆分为<strong>四步</strong></p> <ol><li><p>利用<code>babel</code>完成代码<strong>转换</strong>,并生成单个文件的<strong>依赖</strong></p></li> <li><p>从入口<strong>开始递归分析</strong>，并<strong>生成依赖图谱</strong></p></li> <li><p>将各个<strong>引用模块打包</strong>为一个<strong>立即执行函数</strong></p></li> <li><p>将最终的<code>bundle</code>文件写入<code>bundle.js</code>中</p></li></ol> <p>完整代码见：https://github.com/LuckyWinty/blog/tree/master/code/bundleBuild</p> <h2 id="打包过程"><a href="#打包过程" class="header-anchor">#</a> 打包过程</h2> <p>以上是打包的基本机制，而webpack的<strong>打包过程</strong>，会基于这些基本步骤进行扩展，主要有以下步骤：</p> <ol><li><p><strong>初始化参数</strong> 从配置文件和 Shell 语句中<strong>读取与合并</strong>参数，得出<strong>最终的参数</strong></p></li> <li><p><strong>开始编译</strong> 用上一步得到的参数初始<strong>Compiler对象</strong>，<strong>加载所有配置的插件</strong>，通 过执行对象的run方法开始执行编译</p></li> <li><p><strong>确定入口</strong> 根据配置中的 Entry 找出所有入口文件</p></li> <li><p><strong>编译模块</strong> 从入口文件出发，调用所有配置的 <code>Loader</code> 对模块进行编译，再找出该模块依赖的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</p></li> <li><p><strong>完成模块编译</strong> 在经过第4步使用 Loader 翻译完所有模块后， 得到了每个模块被编译后的最终内容及它们之间的<strong>依赖关系</strong></p></li> <li><p><strong>输出资源</strong>：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 <code>Chunk</code>,再将每个 <code>Chunk</code> 转换成一个单独的文件加入<strong>输出列表</strong>中，这是可以修改输出内容的最后机会</p></li> <li><p><strong>输出完成</strong>：在确定好输出内容后，根据<strong>配置确定输出的路径和文件名</strong>，将文件的内容写入文件系统中</p></li></ol> <p>整个流程概括为3个阶段，<strong>初始化、编译、输出</strong>。而在每个阶段中又会发生很多事件，Webpack会将这些事件广播出来供Plugin使用。具体钩子
可以看官方文档：https://webpack.js.org/api/compiler-hooks/#hooks</p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175e83bc602612d32a2568bfb74f4a9f762b058e9ba39d976c355ae916c27bca73c9fa3d65a&amp;idx=1&amp;mid=2649826040&amp;scene=21&amp;sn=d00485f9421520699740404f8ecf3302#wechat_redirect" target="_blank" rel="noopener noreferrer">Webpack4打包机制原理解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack-loader"><a href="#webpack-loader" class="header-anchor">#</a> Webpack Loader</h2> <p>Loader 就像一个翻译员，能将源文件经过转化后输出新的结果，并且一个文件还可以链式地经过多个翻译员翻译</p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <ul><li><p>一个Loader 的职责是单一的，只需要完成一种转换</p></li> <li><p>一个Loader 其实就是一个Node.js 模块，这个模块需要导出一个函数</p></li></ul> <h3 id="开发loader形式"><a href="#开发loader形式" class="header-anchor">#</a> 开发Loader形式</h3> <ul><li>基本形式</li></ul> <div class="language- extra-class"><pre class="language-text"><code>module.exports = function (source ) {
    return source;
}
</code></pre></div><ul><li>调用第三方模块</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const sass= require('node-sass');
module.exports = function (source) {
  return sass(source);
}
</code></pre></div><p>由于 <code>Loader</code> 运行在 Node.js 中，所以我们可以调用任意 Node.js 自带的 API ，或者安装第三方模块进行调用</p> <ul><li>调用Webpack的Api</li></ul> <div class="language- extra-class"><pre class="language-text"><code>//获取用户为 Loader 传入的 options
const loaderUtils =require ('loader-utils');
module.exports = (source) =&gt; {
    const options= loaderUtils.getOptions(this);
    return source;
}
//返回sourceMap
module.exports = (source)=&gt; {
    this.callback(null, source, sourceMaps);
    //当我们使用 this.callback 返回内容时 ，该 Loader 必须返回 undefined,
    //以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return中
    return;
}
// 异步
module.exports = (source) =&gt; {
    const callback = this.async()
    someAsyncOperation(source, (err, result, sourceMaps, ast) =&gt; {
        // 通过 callback 返回异步执行后的结果
        callback(err, result, sourceMaps, ast)
    })
}
//缓存加速
module.exports = (source) =&gt; {
    //关闭该 Loader 的缓存功能
    this.cacheable(false)
    return source
}
</code></pre></div><p>source参数是compiler 传递给 Loader 的一个文件的原内容，这个函数需要返回处理后的内容，这里为了简单起见，直接将原内容返回了，相当于该Loader 有做任何转换.这里结合了webpack的api和第三方模块之后</p> <p><a href="https://webpack.js.org/api/loaders" target="_blank" rel="noopener noreferrer">更多的webpack Api可以看官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack-plugin"><a href="#webpack-plugin" class="header-anchor">#</a> Webpack Plugin</h2> <p>专注处理 <code>webpack</code> 在编译过程中的<strong>某个特定的任务</strong>的功能模块，可以称为插件概念</p> <ul><li><p>是一个<strong>独立</strong>的模块</p></li> <li><p>模块对<strong>外暴露一个 js 函数</strong></p></li> <li><p>函数的原型 (prototype) 上定义了一个注入 <code>compiler</code> 对象的 apply 方法 apply 函数中需要有通过 <code>compiler</code> 对象挂载的 <code>webpack</code> 事件钩子，钩子的回调中能拿到当前编译的 <code>compilation</code>对象，如果是异步编译插件的话可以拿到回调 callback</p></li> <li><p>完成自定义子编译流程并处理 <code>complition</code> 对象的内部数据</p></li> <li><p>如果异步编译插件的话，数据处理完成后执行 callback 回调</p></li></ul> <h3 id="开发基本形式"><a href="#开发基本形式" class="header-anchor">#</a> 开发基本形式</h3> <p>Webpack 启动后，在读取配置的过程中会先执行 <code>new BasicPlugin(options)</code>初始化一个 <code>BasicPlugin</code> 并获得其实例。在初始化 <code>Compiler</code> 对象后，再调用 <code>basicPlugin.apply (compiler）</code>为插件实例传入 <code>compiler</code> 对象。插件实例在获取到 <code>compiler</code> 对象后，就可以通过 <code>compiler</code>. plugin （事件名称 ，回调函数）监听到 Webpack 广播的事件，并且可以通过 compiler 对象去操作 Webpack。</p> <div class="language- extra-class"><pre class="language-text"><code>// 1、BasicPlugin.js 文件（独立模块）
    // 2、模块对外暴露的 js 函数
    class BasicPlugin{
        //在构造函数中获取用户为该插件传入的配置
        constructor(pluginOptions) {
            this.options = pluginOptions;
        }
        //3、原型定义一个 apply 函数，并注入了 compiler 对象
        apply(compiler) {
            //4、挂载 webpack 事件钩子（这里挂载的是 emit 事件）
            compiler.plugin('emit', function (compilation, callback) {
                // ... 内部进行自定义的编译操作
                // 5、操作 compilation 对象的内部数据
                console.log(compilation);
                // 6、执行 callback 回调
                callback();
            });
        }
    }
// 7、暴露 js 函数
module.exports = BasicPlugin;
</code></pre></div><h3 id="compiler对象"><a href="#compiler对象" class="header-anchor">#</a> Compiler对象</h3> <p>compiler对象是 webpack 的<strong>编译器</strong>对象，compiler对象会在启动 webpack 的时候被一次性地初始化，<strong>compiler对象</strong>中包含了所有 webpack <strong>可自定义操作的配置</strong>，例如 loader 的配置，plugin 的配置，entry的配置等各种原始 webpack 配置</p> <p><img src="/assets/img/1.bd1f492b.jpg" alt="compiler对象"></p> <p>webpack部分源码：https://github.com/webpack/webpack/blob/10282ea20648b465caec6448849f24fc34e1ba3e/lib/webpack.js#L30</p> <h3 id="compilation-对象"><a href="#compilation-对象" class="header-anchor">#</a> Compilation 对象</h3> <p>compilation 实例继承于 compiler，compilation 对象代表了一次单一的版本 webpack 构建和生成编译资源的过程。当运行 webpack 开发环境中间件时，<strong>每当检测到一个文件变化，一次新的编译将被创建，从而生成一组新的编译资源以及新的 compilation 对象</strong>。一个 compilation 对象包含了 当前的模块资源、编译生成资源、变化的文件、以及 被跟踪依赖的状态信息。编译对象也提供了很多关键点回调供插件做自定义处理时选择使用。</p> <p>Compiler 和 Compilation 的区别在于：<strong>Compiler 代表了整个 Webpack 从启动到关闭的生命周期，而 Compilation 只代表一次新的编译</strong></p> <h3 id="tapable-tapable-实例"><a href="#tapable-tapable-实例" class="header-anchor">#</a> Tapable &amp; Tapable 实例</h3> <p>webpack 的插件架构主要基于 Tapable 实现的，Tapable 是 webpack 项目组的一个内部库，主要是抽象了一套插件机制。它类似于 <code>NodeJS</code> 的 <code>EventEmitter</code> 类，专注于自定义事件的触发和操作。除此之外, Tapable 允许你通过回调函数的参数访问事件的生产者</p> <p><img src="/assets/img/2.953fe389.jpg" alt="Tapable"></p> <p>webpack本质上是一种事件流的机制，它的工作流程就是将<strong>各个插件串联起来</strong>，而实现这一切的核心就是Tapable，webpack中最核心的<strong>负责编译的Compiler和负责创建bundles的Compilation都是Tapable的实例</strong>，Tapable 能够让我们为 javaScript 模块添加并应用插件。它可以被其它模块继承或混合。</p> <h3 id="tapable-模型"><a href="#tapable-模型" class="header-anchor">#</a> Tapable 模型</h3> <p>Tapable 简化后的模型，就是我们熟悉的发布订阅者模式</p> <div class="language- extra-class"><pre class="language-text"><code>
class SyncHook{
   constructor(){
      this.hooks = {}
   }
   
   tap(name,fn){
    if(!this.hooks[name])this.hooks[name] = []
     this.hooks[name].push(fn)
   }
 
   call(name){
     this.hooks[name].forEach(hook=&gt;hook(...arguments))
   }
}
</code></pre></div><p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175e8cdc60261db3c0caa44fd58e8d759526e5bb5b6e2caebba957a5996931cc68c18e69d37&amp;idx=1&amp;mid=2649825806&amp;scene=21&amp;sn=e46dbd274e240c4dcc4b778d8b30c67d#wechat_redirect" target="_blank" rel="noopener noreferrer">webpack 插件机制分析及开发调试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="构建工具选择"><a href="#构建工具选择" class="header-anchor">#</a> 构建工具选择</h2> <p>针对不同的场景，选择最合适的工具</p> <p><img src="/assets/img/3.7153636f.jpg" alt="构建工具选择"></p> <p>通过对比，不难看出，<strong>Webpack</strong>和<strong>Rollup</strong>在不同场景下，都能发挥自身优势作用。webpack作为打包工具，但是在定义模块输出的时候，webpack确不支持ESM，webpack插件系统庞大，确实有支持模块级的<code>Tree-Shacking</code>的插件，如<code>webpack-deep-scope-analysis-plugin</code>。但是粒度更细化的，一个模块里面的某个方法，本来如果没有被引用的话也可以去掉的，就不行了....这个时候，就要上rollup了。rollup它<strong>支持程序流分析</strong>，能更加正确的判断项目本身的代码是否有副作用，其实就是rollup的<code>tree-shaking</code>更干净。所以我们的结论是<strong>rollup 比较适合打包 js 的 sdk 或者封装的框架</strong>等，例如，vue 源码就是 rollup 打包的。而 webpack 比较适合打包一些应用，例如<strong>SPA 或者同构项目</strong>等等。</p> <p>结论:在开发应用时使用 <strong>Webpack</strong>，开发库时使用 <strong>Rollup</strong></p> <div class="custom-block tip"><p class="custom-block-title">参考链接</p> <p>来源：winty https://blog.csdn.net/LuckyWinty/article/details/103590665</p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175e83bc602612d32a2568bfb74f4a9f762b058e9ba39d976c355ae916c27bca73c9fa3d65a&amp;idx=1&amp;mid=2649826040&amp;scene=21&amp;sn=d00485f9421520699740404f8ecf3302#wechat_redirect" target="_blank" rel="noopener noreferrer">Webpack4打包机制原理解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175e8cdc60261db3c0caa44fd58e8d759526e5bb5b6e2caebba957a5996931cc68c18e69d37&amp;idx=1&amp;mid=2649825806&amp;scene=21&amp;sn=e46dbd274e240c4dcc4b778d8b30c67d#wechat_redirect" target="_blank" rel="noopener noreferrer">webpack 插件机制分析及开发调试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175eb16c6026200933472fd8f4b8d46b725f072608c2fe4fe11c1ccd78a563d21e0e9ab9a47&amp;idx=1&amp;mid=2649825749&amp;scene=21&amp;sn=c9528c31aa54836e2e3754ff93913e1b#wechat_redirect" target="_blank" rel="noopener noreferrer">webpack中的HMR(热更新)原理剖析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://mp.weixin.qq.com/s?__biz=MzI0MzIyMDM5Ng%3D%3D&amp;chksm=f175eb1cc602620a66821baedcb2663e393f7ae4857e8daf6d57e4c436f9a7297a555d0e4750&amp;idx=1&amp;mid=2649825759&amp;scene=21&amp;sn=726279d3dfc2ea0b6ba34788517753ad#wechat_redirect" target="_blank" rel="noopener noreferrer">Webpack性能优化总结大全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learning/typescript/ts-collection-react.html" class="prev">
        【好文】耗时一年整理，全网最全的TypeScript踩坑集锦（React + TS 项目问题）
      </a></span> <span class="next"><a href="/readBook/HighPerformanceJS/">
        高性能javascript
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.84527245.js" defer></script><script src="/assets/js/2.950285f0.js" defer></script><script src="/assets/js/6.336af2bb.js" defer></script>
  </body>
</html>
