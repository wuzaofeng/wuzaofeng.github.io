(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{288:function(t,s,e){"use strict";e.r(s);var n=e(0),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"verdaccio-指南"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#verdaccio-指南"}},[t._v("#")]),t._v(" verdaccio 指南")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("前言")]),t._v(" "),e("p",[t._v("verdaccio是一个npm的代理工具，可以将私有的npm包发布至上面，提供权限控制的功能；也可以缓存下载的npm包，以加快再次下载的速度\ngithub: https://github.com/verdaccio/verdaccio")])]),t._v(" "),e("h2",{attrs:{id:"目的"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目的"}},[t._v("#")]),t._v(" 目的")]),t._v(" "),e("p",[t._v("一些公共的组件，service，或utils上传到npm。供各个项目使用。")]),t._v(" "),e("p",[t._v("如netwayapi ,witenssapi, bmsapi等。")]),t._v(" "),e("p",[t._v("建立verdaccio的意义在于，"),e("strong",[t._v("提高不同的前端项目之间的代码复用率")])]),t._v(" "),e("p",[t._v("对于单个项目而言，MVVM框架、CSS预处理器的使用可以增强该项目的模块化程度，多次使用到的代码可以作为"),e("strong",[t._v("公共模块抽离")]),t._v("出来")]),t._v(" "),e("p",[t._v("然而对于多个项目来说，可以维护私有的"),e("strong",[t._v("npm公共模块")]),t._v("、"),e("strong",[t._v("上层项目框架")]),t._v("，"),e("strong",[t._v("增强代码复用")]),t._v("，"),e("strong",[t._v("减少开发人员的重复劳动和出错机会")])]),t._v(" "),e("h2",{attrs:{id:"本地如何下载和使用私包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地如何下载和使用私包"}},[t._v("#")]),t._v(" 本地如何下载和使用私包")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("安装"),e("strong",[t._v("nrm")]),t._v("，添加verdaccio作为可选的"),e("strong",[t._v("npm源")])])]),t._v(" "),e("li",[e("p",[t._v("切换至verdaccio源，登录dev账号即可使用 npm install @xzfe/* 下载指定的私包，亦可使用scope限制@xzfe以下的包使用该账号登录")])])]),t._v(" "),e("h2",{attrs:{id:"jenkins构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins构建"}},[t._v("#")]),t._v(" Jenkins构建")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("前端项目在jenkins构建过程中，需要执行npm install，为了防止私仓被外部人员使用、保护代码安全，需要"),e("strong",[t._v("先登录预设的deploy账号")])])]),t._v(" "),e("li",[e("p",[t._v("在docker build的过程中，使用node-pty编写"),e("strong",[t._v("运行npm login的prompt的脚本")]),t._v("，可实现"),e("strong",[t._v("自动登录")])])])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("const pty = require('node-pty')\nconst ptyProcess = pty.spawn('npm', ['login'])\n\nconst username = process.env.NPM_USERNAME\nconst passwd = process.env.NPM_PASSWD\n\nlet usernameDirty = false\nlet passwordDirty = false\nlet emailDirty = false\n\nptyProcess.on('data', (data) => {\n  process.stdout.write(data)\n  if (data.toString().toLowerCase().indexOf('username') !== -1 && !usernameDirty) {\n    usernameDirty = true\n    ptyProcess.write(`${username}\\r\\n`)\n  }\n  if (data.toString().toLowerCase().indexOf('password') !== -1 && !passwordDirty) {\n    passwordDirty = true\n    ptyProcess.write(`${passwd}\\r\\n`)\n  }\n  if (data.toString().toLowerCase().indexOf('email') !== -1 && !emailDirty) {\n    emailDirty = true\n    ptyProcess.write('zhi.huang@bluestonehk.com\\r\\n')\n  }\n  if (data.toString().toLowerCase().indexOf('logged in') !== -1) {\n    console.log('\\nlogged successfully!')\n  }\n})\n\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("登录deploy账号后，"),e("strong",[t._v("即可获取下载权限")]),t._v("，安装存储在verdaccio上的依赖")])])])}),[],!1,null,null,null);s.default=r.exports}}]);