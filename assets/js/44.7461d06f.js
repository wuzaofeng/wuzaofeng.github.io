(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{296:function(t,n,e){"use strict";e.r(n);var a=e(0),r=Object(a.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"网厅首屏优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网厅首屏优化"}},[t._v("#")]),t._v(" 网厅首屏优化")]),t._v(" "),e("h2",{attrs:{id:"_1-跳转链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-跳转链接"}},[t._v("#")]),t._v(" 1. 跳转链接")]),t._v(" "),e("p",[t._v("不能通过直接改变window.loation.href跳转，需要通过router.push跳转，不然就是重新刷新页面")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// 判断链接是否该项目的路由链接，如果是通过路由跳转，否则通过window.location.href跳转\n\n// 跳转\nexport function toSkip (url, _this) {\n  const { origin } = window.location\n  const reg = new RegExp(`^${origin}`)\n  // 判断是否当前域名地址\n  if (reg.test(url)) {\n    const _url = url.replace(reg, '')\n    _this.$router.push(_url)\n  } else {\n    location.href = url\n  }\n")])])]),e("h2",{attrs:{id:"_2-该项目首屏渲染时渲染第三方的链接，比如高德地图，网易七鱼等第三方链接，按需加载链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-该项目首屏渲染时渲染第三方的链接，比如高德地图，网易七鱼等第三方链接，按需加载链接"}},[t._v("#")]),t._v(" 2.该项目首屏渲染时渲染第三方的链接，比如高德地图，网易七鱼等第三方链接，按需加载链接")]),t._v(" "),e("h3",{attrs:{id:"按需加载js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#按需加载js"}},[t._v("#")]),t._v(" 按需加载js")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("export function loadScript (url, key = '') {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script')\n    script.charset = 'utf-8'\n    script.src = url\n    document.body.appendChild(script)\n    script.addEventListener('load', function () {\n      resolve(key ? window[key] : '')\n    })\n    script.addEventListener('error', function (...params) {\n      reject(params)\n    })\n  })\n}\n")])])]),e("h3",{attrs:{id:"高德地图按需加载，并且实现单例模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#高德地图按需加载，并且实现单例模式"}},[t._v("#")]),t._v(" 高德地图按需加载，并且实现单例模式")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("import { loadScript } from '@/utils/utils'\nimport config from '@/config'\n\nclass Map {\n  constructor (AMap, key, v) {\n    this.instance = null\n    this._key = key\n    this._v = v\n    this.AMap = AMap // window传入的AMap\n    this.map = new AMap.Map('') // 实例化的值\n  }\n\n  getLocation () {\n    const _this = this\n    return new Promise((resolve, reject) => {\n      // 高德API获取定位\n      _this.map.plugin('AMap.Geolocation', () => {\n        let geoLocation = new _this.AMap.Geolocation({\n          enableHighAccuracy: true, // 是否使用高精度定位，默认：true\n          timeout: 10000 // 设置定位超时时间，默认：无穷大\n        })\n        geoLocation.getCurrentPosition()\n        _this.AMap.event.addListener(geoLocation, 'complete', (data) => {\n          resolve(data)\n        })\n        _this.AMap.event.addListener(geoLocation, 'error', (error) => {\n          reject(error)\n        })\n      })\n    })\n  }\n\n  static async getInstance () {\n    if (!this.instance) {\n      const _v = '1.4.15'\n      const _key = 'cbfc0b347323de3f78edf4145a93df26'\n      if (!window.AMap) {\n        await loadScript(`${config.loadScript.map}?v=${_v}&key=${_key}`, 'AMap')\n      }\n      this.instance = new Map(window.AMap, _key, _v)\n    }\n    return this.instance\n  }\n}\nexport default Map\n\n")])])]),e("h3",{attrs:{id:"七鱼"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七鱼"}},[t._v("#")]),t._v(" 七鱼")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("export function loadYSF () {\n  return new Promise(async (resolve, reject) => {\n    if (!window.ysf) {\n      await loadScript(config.loadScript.qiyukf, 'ysf')\n    }\n    window.ysf('onready', function () {\n      resolve(window.ysf)\n    })\n  })\n}\n")])])]),e("h2",{attrs:{id:"遇到的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),e("p",[t._v("如果是封装在组件里面的，反复使用的npm包，比如exif.min.js，应该通过npm包引入")]),t._v(" "),e("p",[t._v("如果页面有引入两个相同的上传组件，那么就会同时加载script标签")])])}),[],!1,null,null,null);n.default=r.exports}}]);